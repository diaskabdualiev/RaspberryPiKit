==========================================================
–£—Ä–æ–∫ 7: –£–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–π —Ä–∞–¥–∞—Ä üì°
==========================================================

–¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å
-------------------
–£–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–π –¥–∞—Ç—á–∏–∫ **HC-SR04** –∏–∑–º–µ—Ä—è–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∑–≤—É–∫–æ–≤—ã—Ö –≤–æ–ª–Ω –Ω–∞ —á–∞—Å—Ç–æ—Ç–µ –æ–∫–æ–ª–æ 40 –∫–ì—Ü. –î–∞—Ç—á–∏–∫ –≤—ã–¥–∞–µ—Ç –¥–≤–∞ —Å–∏–≥–Ω–∞–ª–∞:
- **TRIG**: –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∏–º–ø—É–ª—å—Å –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ "—É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–≥–æ –ø–∞–∫–µ—Ç–∞".
- **ECHO**: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ—Ç—Ä–∞–∂—ë–Ω–Ω—ã–π —Å–∏–≥–Ω–∞–ª, –∏–∑–º–µ—Ä—è—è –≤—Ä–µ–º—è –º–µ–∂–¥—É –æ—Ç–ø—Ä–∞–≤–∫–æ–π –∏ –ø—Ä–∏—ë–º–æ–º.

–ó–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–≤—É–∫–∞ (~343 –º/—Å) –∏ –≤—Ä–µ–º—è –ø–æ–ª—ë—Ç–∞, –º–æ–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ:

.. .. math::
..    \text{Distance} = \frac{(\text{Time} * 34300)}{2} \text{ (—Å–º)}

–í –¥–∞–Ω–Ω–æ–º —É—Ä–æ–∫–µ –º—ã –¥–æ–ø–æ–ª–Ω–∏–º —Å—Ö–µ–º—É **–∞–∫—Ç–∏–≤–Ω—ã–º –∑—É–º–º–µ—Ä–æ–º**, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–¥–∞–≤–∞—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏. –¢–∞–∫–æ–π –ø—Ä–∏–Ω—Ü–∏–ø –ª–µ–∂–∏—Ç –≤ –æ—Å–Ω–æ–≤–µ "–ø–∞—Ä–∫—Ç—Ä–æ–Ω–∏–∫–æ–≤".

–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
----------------------
- Raspberry Pi
- HC-SR04 (—É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤–æ–π –¥–∞–ª—å–Ω–æ–º–µ—Ä)
- –ê–∫—Ç–∏–≤–Ω—ã–π –∑—É–º–º–µ—Ä
- –ú–∞–∫–µ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞ (breadboard)
- –°–æ–µ–¥–∏–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–æ–¥–∞

–°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
-----------------
.. figure:: images/lesson7.png
   :width: 80%
   :align: center

–ó–∞–ø—É—Å–∫ –∫–æ–¥–∞
-----------
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `hcsr04.py` –≤ –ø–∞–ø–∫–µ `lessons/lesson7/`:

   .. code-block:: bash

      nano lessons/lesson7/hcsr04.py

2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É:

   .. code-block:: bash

      python3 lessons/lesson7/hcsr04.py

–ö–æ–¥ –ø—Ä–æ–≥—Ä–∞–º–º—ã
-------------
–§–∞–π–ª: `lessons/lesson7/hcsr04.py`

.. code-block:: python

   from gpiozero import DistanceSensor, Buzzer
   from time import sleep

   # –ü–∏–Ω—ã (BCM)
   TRIG = 23
   ECHO = 24
   BUZZER = 18

   # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞—Ç—á–∏–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∏ –±—É–∑–∑–µ—Ä–∞
   sensor = DistanceSensor(echo=ECHO, trigger=TRIG, max_distance=2.0)  # –º–∞–∫—Å. –¥–∏—Å—Ç–∞–Ω—Ü–∏—è ~2 –º
   buzzer = Buzzer(BUZZER)

   def beep(duration_on, duration_off):
       """ –ü–æ–¥–∞—Ç—å –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç—ã–π —Å–∏–≥–Ω–∞–ª –±—É–∑–∑–µ—Ä–∞ """
       buzzer.on()
       sleep(duration_on)
       buzzer.off()
       sleep(duration_off)

   try:
       print("–ó–∞–ø—É—Å–∫ –ø–∞—Ä–∫—Ç—Ä–æ–Ω–∏–∫–∞ (–Ω–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞)...")
       while True:
           dist = sensor.distance * 100  # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –º–µ—Ç—Ä—ã -> —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã
           print(f"–¢–µ–∫—É—â–µ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ = {dist:.1f} —Å–º")

           if dist <= 5:
               # –ü–æ—á—Ç–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π —Å–∏–≥–Ω–∞–ª
               beep(0.1, 0.05)

           elif dist <= 10:
               # –ë—ã—Å—Ç—Ä—ã–µ —Å–∏–≥–Ω–∞–ª—ã
               beep(0.1, 0.1)

           elif dist <= 20:
               # –°—Ä–µ–¥–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã
               beep(0.2, 0.3)

           elif dist <= 30:
               # –ú–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
               beep(0.3, 0.5)

           else:
               # –î–∞–ª–µ–∫–æ ‚Äî —Ç–∏—à–∏–Ω–∞
               buzzer.off()
               sleep(1)

   except KeyboardInterrupt:
       print("\n–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
       buzzer.off()
       print("–ó–∞–≤–µ—Ä—à–µ–Ω–æ.")

–†–∞–∑–±–æ—Ä –∫–æ–¥–∞
-----------
- `DistanceSensor(echo=ECHO, trigger=TRIG, max_distance=2.0)` ‚Äì –æ–±—ä–µ–∫—Ç –¥–∞—Ç—á–∏–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è. –ü–∞—Ä–∞–º–µ—Ç—Ä `max_distance` –∑–∞–¥–∞—ë—Ç –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–∏—Å—Ç–∞–Ω—Ü–∏—é (–≤ –º–µ—Ç—Ä–∞—Ö) –¥–ª—è –∫–∞–ª–∏–±—Ä–æ–≤–∫–∏.
- `buzzer = Buzzer(BUZZER)` ‚Äì –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑—É–º–º–µ—Ä–∞.
- `beep(duration_on, duration_off)` ‚Äì —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞.
  - `buzzer.on() / buzzer.off()` ‚Äì –≤–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∑—É–º–º–µ—Ä–∞.
  - `sleep(...)` ‚Äì –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–∞–º–∏.
- `dist = sensor.distance * 100` ‚Äì —á—Ç–µ–Ω–∏–µ –¥–∏—Å—Ç–∞–Ω—Ü–∏–∏ –≤ –º–µ—Ç—Ä–∞—Ö, —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 100 –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã.
- –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `dist` –≤–∞—Ä—å–∏—Ä—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É —Å–∏–≥–Ω–∞–ª–∞–º–∏ –∑—É–º–º–µ—Ä–∞.

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
-------------------
1. –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –±–ª–∏–∂–µ 5 —Å–º, —Å–∏–≥–Ω–∞–ª –ø–æ—á—Ç–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π.
2. 5‚Äì10 —Å–º ‚Äì –±—ã—Å—Ç—Ä—ã–µ —Å–∏–≥–Ω–∞–ª—ã.
3. 10‚Äì20 —Å–º ‚Äì —Å—Ä–µ–¥–Ω—è—è —á–∞—Å—Ç–æ—Ç–∞ —Å–∏–≥–Ω–∞–ª–æ–≤.
4. 20‚Äì30 —Å–º ‚Äì –º–µ–¥–ª–µ–Ω–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã.
5. >30 —Å–º ‚Äì –∑—É–º–º–µ—Ä –Ω–µ –ø–æ–¥–∞—ë—Ç —Å–∏–≥–Ω–∞–ª.

.. figure:: images/hcsr04_buzzer.gif
   :width: 50%
   :align: center

   **–†–∏—Å. 2:** –ü—Ä–∏–º–µ—Ä "–ø–∞—Ä–∫—Ç—Ä–æ–Ω–∏–∫–∞" —Å —É–ª—å—Ç—Ä–∞–∑–≤—É–∫–æ–≤—ã–º –¥–∞—Ç—á–∏–∫–æ–º

–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã
-----------------
–ù–∞–∂–º–∏—Ç–µ **Ctrl + C** –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ, —á—Ç–æ–±—ã –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É. –¢–µ–ø–µ—Ä—å –≤—ã —É–º–µ–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–µ–π—à—É—é —Å–∏—Å—Ç–µ–º—É "–ø–∞—Ä–∫—Ç—Ä–æ–Ω–∏–∫–∞" –∏–ª–∏ "–¥–∞–ª—å–Ω–æ–º–µ—Ä–∞", –∏—Å–ø–æ–ª—å–∑—É—è HC-SR04 –∏ –∑—É–º–º–µ—Ä.
